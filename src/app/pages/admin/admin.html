<div class="admin-container">
  <div class="admin-header">
    <div>
      <h1>Panel de Administraci√≥n</h1>
      <p>Gestiona las noticias de la comunidad</p>
    </div>
    <button class="btn-primary" (click)="openForm()">
      + Nueva Noticia
    </button>
  </div>

  @if (mensaje()) {
  <div class="mensaje" [class.success]="mensaje()?.tipo === 'success'" [class.error]="mensaje()?.tipo === 'error'">
    {{ mensaje()?.texto }}
  </div>
  }

  <div class="noticias-table">
    <table>
      <thead>
        <tr>
          <th>Imagen</th>
          <th>T√≠tulo</th>
          <th>Categor√≠a</th>
          <th>Fecha</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (noticia of noticias(); track noticia.id) {
        <tr>
          <td>
            <img [src]="noticia.imagen" [alt]="noticia.titulo" class="table-img" />
          </td>
          <td>
            <div class="noticia-info">
              <span class="noticia-titulo">{{ noticia.titulo }}</span>
              <span class="noticia-desc">{{ noticia.descripcion }}</span>
            </div>
          </td>
          <td>
            <span class="categoria-badge" [style.background-color]="getCategoriaColor(noticia.categoria)">
              {{ noticia.categoria }}
            </span>
          </td>
          <td>{{ noticia.fecha | date:'dd/MM/yyyy' }}</td>
          <td>
            <div class="acciones">
              <button class="btn-edit" (click)="openForm(noticia)">‚úèÔ∏è</button>
              <button class="btn-delete" (click)="eliminarNoticia(noticia.id)">üóëÔ∏è</button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>

@if (showForm()) {
<div
  style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;"
  (click)="closeForm()">

  <!-- CONTENEDOR DEL MODAL -->
  <div (click)="$event.stopPropagation()"
    style="background: white; border-radius: 20px; width: 100%; max-width: 700px; max-height: 90vh; overflow-y: auto; padding: 30px; position: relative; z-index: 10000; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">

    <!-- HEADER -->
    <div
      style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #ccc;">
      <h2 style="margin: 0; font-size: 24px; color: #333;">
        {{ editingNoticia() ? 'Editar Noticia' : 'Nueva Noticia' }}
      </h2>
      <button (click)="closeForm()" type="button"
        style="background: #f44336; color: white; border: none; font-size: 24px; width: 40px; height: 40px; border-radius: 8px; cursor: pointer; font-weight: bold;">
        ‚úï
      </button>
    </div>

    <!-- FORMULARIO -->
    <form (ngSubmit)="guardarNoticia()" style="display: flex; flex-direction: column; gap: 20px;">

      <!-- T√≠tulo -->
      <div>
        <label style="display: block; font-weight: bold; margin-bottom: 8px; color: #333;">T√≠tulo *</label>
        <input type="text" [ngModel]="titulo()" (ngModelChange)="titulo.set($event)" name="titulo"
          placeholder="T√≠tulo de la noticia" required
          style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box;" />
      </div>

      <!-- Descripci√≥n -->
      <div>
        <label style="display: block; font-weight: bold; margin-bottom: 8px; color: #333;">Descripci√≥n *</label>
        <textarea [ngModel]="descripcion()" (ngModelChange)="descripcion.set($event)" name="descripcion"
          placeholder="Descripci√≥n breve" rows="3" required
          style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; resize: vertical;"></textarea>
      </div>

      <!-- Contenido -->
      <div>
        <label style="display: block; font-weight: bold; margin-bottom: 8px; color: #333;">Contenido</label>
        <textarea [ngModel]="contenido()" (ngModelChange)="contenido.set($event)" name="contenido"
          placeholder="Contenido completo (opcional)" rows="5"
          style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; resize: vertical;"></textarea>
      </div>

      <!-- Categor√≠a -->
      <div>
        <label style="display: block; font-weight: bold; margin-bottom: 8px; color: #333;">Categor√≠a *</label>
        <select [ngModel]="categoria()" (ngModelChange)="categoria.set($event)" name="categoria" required
          style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box;">
          <option value="">Seleccionar...</option>
          @for (cat of categorias(); track cat) {
          @if (cat !== 'Todos') {
          <option [value]="cat">{{ cat }}</option>
          }
          }
        </select>
      </div>

      <!-- Imagen -->
      <div>
        <label style="display: block; font-weight: bold; margin-bottom: 8px; color: #333;">Imagen de la Noticia</label>

        <!-- Bot√≥n de Upload -->
        <div style="margin-bottom: 15px;">
          <input type="file" id="fileInput" accept="image/png,image/jpeg,image/jpg,image/gif,image/webp"
            (change)="onFileSelected($event)" style="display: none;" #fileInput />
          <button type="button" (click)="fileInput.click()" [disabled]="uploadingImage()"
            style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
            @if (uploadingImage()) {
            <span style="animation: spin 1s linear infinite; display: inline-block;">‚è≥</span>
            Subiendo imagen...
            } @else {
            <span style="font-size: 20px;">üì§</span>
            Subir Mi Imagen
            }
          </button>
          <p style="font-size: 13px; color: #666; margin-top: 8px; text-align: center;">
            Formatos: PNG, JPG, GIF, WEBP ‚Ä¢ Tama√±o m√°ximo: 5MB
          </p>
        </div>

        <!-- Separador OR -->
        <div style="display: flex; align-items: center; gap: 10px; margin: 20px 0;">
          <div style="flex: 1; height: 1px; background: #ddd;"></div>
          <span style="color: #999; font-weight: bold; font-size: 14px;">O</span>
          <div style="flex: 1; height: 1px; background: #ddd;"></div>
        </div>

        <!-- URL Manual -->
        <div>
          <label style="display: block; font-weight: 500; margin-bottom: 8px; color: #666; font-size: 14px;">O ingresa
            una URL:</label>
          <input type="url" [ngModel]="imagen()" (ngModelChange)="imagen.set($event)" name="imagen"
            placeholder="https://ejemplo.com/imagen.jpg"
            style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box;" />
        </div>
      </div>

      <!-- Preview -->
      @if (imagen()) {
      <div style="margin-top: 10px;">
        <img [src]="imagen()" alt="Preview"
          style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 8px; border: 2px solid #ddd;">
      </div>
      }

      <!-- Botones -->
      <div
        style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 20px; padding-top: 20px; border-top: 2px solid #ddd;">
        <button type="button" (click)="closeForm()"
          style="padding: 12px 24px; background: #ccc; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: bold;">
          Cancelar
        </button>
        <button type="submit" [disabled]="loading()"
          style="padding: 12px 24px; background: #2563eb; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: bold;">
          {{ loading() ? 'Guardando...' : (editingNoticia() ? 'Actualizar' : 'Crear') }}
        </button>
      </div>

    </form>

  </div>
</div>
}